<!DOCTYPE html>
<html>
    <body class="body">
        <link rel="style" href="styling.css">
        <h1>Daniel's Cloud Computing Program 4</h1>

        <div class="main">
            <button onclick="loadButtonClicked()" class="button">Load Data</button>
            <button onclick="clearButtonClicked()" class="button">Clear Data</button>
            <form name="inputForm">
                First Name:
                <input name="firstName" type="text" value=""/>
                Last Name:
                <input name="lastName" type="text" value=""/>
            </form>
            <button onclick="queryButtonClicked()" class="button">Query Data</button>
    
            <p id="userfeedback"></p>
            <p id="queryresults"></p>
        </div>
        
        <script language="Javascript">
            function loadButtonClicked() {
                document.getElementById("userfeedback").innerHTML = "Loading data into Bucket and NoSQL Storage";
                bucketLoadURL = "https://htry3uqdfb.execute-api.us-east-1.amazonaws.com/prod/loadbucket";
                tableLoadURL = "https://htry3uqdfb.execute-api.us-east-1.amazonaws.com/prod/loadtable";
                
                var request = new XMLHttpRequest();
                request.open("POST", bucketLoadURL, true);
                request.send();
                request.onreadystatechange = function () {
                    if (request.readyState == 4 && request.status == 200) {
                        document.getElementById("userfeedback").innerHTML = request.response;
                        request.open("POST", tableLoadURL, true);
                        request.send();
                        request.onreadystatechange = function () {
                            if (request.readyState == 4 && request.status == 200) {
                                document.getElementById("userfeedback").innerHTML = request.response;
                            }   
                        };
                    }
                };
            }

            function clearButtonClicked() {
                document.getElementById("userfeedback").innerHTML = "Deleting all data from Bucket and NoSQL Storage";
                clearStorageURL = "https://htry3uqdfb.execute-api.us-east-1.amazonaws.com/prod/emptyallstorage";
                var request = new XMLHttpRequest();
                request.open("DELETE", clearStorageURL, true);
                request.send();
                request.onreadystatechange = function () {
                    if (request.readyState == 4 && request.status == 200) {
                        document.getElementById("userfeedback").innerHTML = request.response;
                    }
                };
            }

            function queryButtonClicked() {
                // TODO:
                // - Use Query Library to query Dyanmo DB table using first and last name data input
                // - Print out all matches or "No Matches in Dyanmo Table"
                var firstNameInput = document.forms["inputForm"]["firstName"].value.trim();
                var lastNameInput = document.forms["inputForm"]["lastName"].value.trim();

                document.getElementById("userfeedback").innerHTML = "Querying......";
                if (firstNameInput == "" && lastNameInput == "") {
                    alert("Querying the database requires at least 1 input value");
                    return;
                }

                const requestBody = {
                    firstname: firstNameInput,
                    lastname: lastNameInput
                };
                queryTableURL = "https://htry3uqdfb.execute-api.us-east-1.amazonaws.com/prod/querytable";
                var request = new XMLHttpRequest();
                request.open("GET", queryTableURL, true)
                request.send(JSON.stringify(requestBody))
                request.onreadystatechange = function () {
                if (request.readyState == 4 && request.status == 200) {
                        document.getElementById("queryresults").innerHTML = request.responseText;
                    }
                };
            }
        </script>
    </body>
</html>